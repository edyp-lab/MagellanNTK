<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inside MagellanNTK • MODIStsp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Inside MagellanNTK">
<meta property="og:description" content="MagellanNTK">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-84499524-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-84499524-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MODIStsp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/interactive_execution.html">Interactive Execution - the MODIStsp GUI</a>
    </li>
    <li>
      <a href="../articles/noninteractive_execution.html">Non-Interactive Execution from within R</a>
    </li>
    <li>
      <a href="../articles/standalone_execution.html">Standalone Execution and Scheduled Processing</a>
    </li>
    <li>
      <a href="../articles/output.html">Outputs Format and Naming Conventions</a>
    </li>
    <li>
      <a href="../articles/analyze.html">Accessing and Analyzing Processed Data from R</a>
    </li>
    <li>
      <a href="../articles/products_list.html">Supported MODIS Products</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faq.html">
    <span class="fa fa-question-circle-o"></span>
     
    faq
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/ropensci/MODIStsp/" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
<li>
  <a href="../articles/lorenzo.html">
    <span class="fa fa-cross"></span>
     
    dedication
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Inside MagellanNTK</h1>
            <h3 data-toc-skip class="subtitle">A developer’s
guideline</h3>
                        <h4 data-toc-skip class="author">Samuel
Wieczorek</h4>
            
            <h4 data-toc-skip class="date">avril 09, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/prostarproteomics/MagellanNTK/blob/HEAD/vignettes/insideMagellanNTK.Rmd" class="external-link"><code>vignettes/insideMagellanNTK.Rmd</code></a></small>
      <div class="hidden name"><code>insideMagellanNTK.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>This document covers the functionalities.</p>
    </div>
    
<style type="text/css">
.bordered{
  border-style: solid;
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The user manual of MagellanNTK covers a strict end-user aspect of
MagellanNTK, describing the user interfaces and how to navigate through
the steps of a workflow. This document focuses on a more technical view
of the package and how to use it to instantiate workflows written bby
thrid party</p>
<p>A guide to understand how the workflows code is built and how to
wrote some code is available in vignette xxx.</p>
<p>The package MagellanNTK has two main objectives:</p>
<ul>
<li><p>be generic to handle several different types of
datasets,</p></li>
<li><p>versatility to integrate many workflows</p></li>
<li><p>embed a maximum of code so as to minimize the code to write for
process modules. Thus, process modules, in a sense, only contains the ui
elements for the process and the logics of the modules.</p></li>
</ul>
<p>It facilitates the work for writing process modules but has some
constraints such as the naming conventions which are important. To allow
writing less ‘dev’ code, the core of Magellan is mostly based on dynamic
function surcharge thus, the naming conventions are fundamental.</p>
<p>The package MagellanNTK is a toolkit containing all tools to build a
workflow. The instantiate of a workflow is dynamic in the sense that it
is build with the parameters. It is an fundamental characteristic of
MagellanNTK: it s a collection of bricks that are put together at the
time of launching. MagellanNTK is a generic package that offers a
graphical workflow manager, based on Shiny modules. It is very generic
and can handle different types of objects but they must be of type list
(see <span class="math inline">\(\ref{objecttypes}\)</span>).</p>
</div>
<div class="section level2">
<h2 id="general-principles">General principles<a class="anchor" aria-label="anchor" href="#general-principles"></a>
</h2>
<p>MagellanNTK is a Shiny application which provides a workflow
management framework. The data processing tools are not implemented if
MagellanNTK but are passed are parameters to the application. Thus,
alone, MagellanNTK is usefulness. To work, MagellanNTK needs:</p>
<ul>
<li><p>data processing tools (as Shiny modules)</p></li>
<li><p>a list of datasets</p></li>
</ul>
<p>These data processing modules can be in a separate R script or part
of a R package. The most important is that the functions ui(), config()
and server() are available in the same R environment as MagellanNTK.</p>
<p>The package MagellanNTK mainly manage two aspects :</p>
<ul>
<li><p>the navigation between the different user interfaces</p></li>
<li><p>the management of the datasets during the execution of the
workflows.</p></li>
</ul>
<p>All along this document, one will take some examples to explain the
nomenclature.</p>
<div class="section level3">
<h3 id="global-architecture">Global architecture<a class="anchor" aria-label="anchor" href="#global-architecture"></a>
</h3>
<p>MagellanNTK cannot be run alone, it is always run with a package
which contains the information about the steps to manage.</p>
<div class="bordered">
<div class="figure" style="text-align: center">
<img src="figs/globalArch.png" alt="UI process" width="100%"><p class="caption">
UI process
</p>
</div>
</div>
<p>The final shiny app is showed by Magellan, it is its functions that
are called in the shiny app. Inside Magellan, three main operations are
run:</p>
<ul>
<li><p>Magellan needs to read the configuration of the module to adjust
some of its features (timelines, variables): those information are
stored in the code of the process. The first operation of Magellan is to
build the name of the source file for the module and to load the source
code. More specially, two infos are important: the configuration of the
process and the list of UIs of the steps.</p></li>
<li><p>This loading is accompanied by the insertion of some necessary
code in the module. Certain generic functions are stored in Magellan to
let the external package as light and easy to understand as possible.
While loading the source code, those functions are inserted
inside</p></li>
</ul>
<p>MagellanNTK reads the configuration class and then builds function
names to load them. This is why these functions must be well-named and
available in the R environment.</p>
</div>
<div class="section level3">
<h3 id="workflows-are-built-dynamically">Workflows are built dynamically<a class="anchor" aria-label="anchor" href="#workflows-are-built-dynamically"></a>
</h3>
</div>
<div class="section level3">
<h3 id="generic-templates-functions">Generic templates functions<a class="anchor" aria-label="anchor" href="#generic-templates-functions"></a>
</h3>
<p>Some important functions are essential to instantiate a workflow with
MagellanNTK, event if it is only for examples or with empty
datasets.</p>
<p>These functions are implemented in MagellantNTK as generic functions
and they are mostly empty. The goal is just to make available their name
in the R environment.</p>
<p>As one will see later in this document, a module to integrate into
MagellanNTK have to provide such functions. In the contrary, an error
will occur. When a module is integrated, its specialized functions are
launched and the replace the generic functions in MagellanNTK. This
continues the spirit of dynamic workflow building.</p>
</div>
</div>
<div class="section level2">
<h2 id="workflows-hierarchy">Workflows hierarchy<a class="anchor" aria-label="anchor" href="#workflows-hierarchy"></a>
</h2>
<p>For e more details on our definitions of workflows, processes,
pipelines, please refer to the User manual of MagellanNTK.</p>
<p>One will consider here process and pipelines levels. One consider the
default level is a pipeline, composed of several processes (as steps).
Thus, a process always own to a pipeline.</p>
<p>A pipeline is identified by its name while a process is identified by
a name composed of the name of the pipeline it belongs to and its own
name. For example, ‘Pipeline A’ will be identified by ‘PipelineA’, and
the process 2 of this pipeline is identified by
‘PipelineA_Process2’.</p>
<div class="bordered">
<div class="figure" style="text-align: center">
<img src="figs/hierarchy_funcs.png" alt="UI process" width="50%"><p class="caption">
UI process
</p>
</div>
</div>
<p>It is possible that a process is the same in two pipelines. For
simplicity reasons, one decide to duplicate their code and they have
different names.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The installation is quite simple as it is sufficient to install the
package. This is explicitly needed only if one want to launch the
workflow manager in a standalone mode.</p>
<p>To install this package, start R (version “4.3”) and enter:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'prostarproteomics/MagellanNTK'</span><span class="op">)</span></span></code></pre>
<p>If MagellanNTK is about to be used via a Shiny module, the latter is
supposed to load or import the package MagellanNTK.</p>
<div class="section level3">
<h3 id="understanding-files-for-magellanntk">Understanding files for MagellanNTK<a class="anchor" aria-label="anchor" href="#understanding-files-for-magellanntk"></a>
</h3>
<p>The engine is getting the code of steps which i supposed to be
available in the R environment. This can be done directly via the R
console or via a package.</p>
<p>Besides those code files, the developer of the module process.</p>
<p>In this section, on describes which files are needed to feed
MagellanNTK so as to use it.</p>
</div>
</div>
<div class="section level2">
<h2 id="process-workflow">Process workflow<a class="anchor" aria-label="anchor" href="#process-workflow"></a>
</h2>
<div class="section level3">
<h3 id="setting-example">Setting example<a class="anchor" aria-label="anchor" href="#setting-example"></a>
</h3>
<p>In a effort of clarity and to make this document more comprehensive,
one will take a concrete example to explain the things.</p>
<p>Let’s consider a process named Process1 which have three steps</p>
<p>A complete source code for a data processing tool is composed of
three functions. Suppose that the workflow is called Process1 and is
part of a pipeline called ‘Pipeline A’, than the three functions
are:</p>
<ul>
<li><p>PipelineA_Process1_conf() which contains information about the
tool needed to configure MagellanNTK</p></li>
<li><p>PipelineA_Process1_ui() which is the ui part of the Shiny
application</p></li>
<li><p>PipelineA_Process1_server() which is the server part of the Shiny
application</p></li>
</ul>
<p>Note: Each data processing tool must have these three functions.</p>
<p>For example, in this case, the following functions:</p>
<ul>
<li><p>PipelineA_conf(), PipelineA_ui(), PipelineA_server()</p></li>
<li><p>PipelineA_Description_conf(), PipelineA_Description_ui(),
PipelineA_Description_server()</p></li>
<li><p>PipelineA_Process1_conf(), PipelineA_Process1_ui(),
PipelineA_Process1_server()</p></li>
<li><p>PipelineA_Process2_conf(), PipelineA_Process2_ui(),
PipelineA_Process2_server()</p></li>
<li><p>PipelineA_Process3_conf(), PipelineA_Process3_ui(),
PipelineA_Process3_server()</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h3>
<p>The first thing to set is a configuration for the workflow one wants
to run with MagellanNTK. This allow to give necessary information to
MagellanNTK so that it will know how ti dynamically build the
interface.</p>
<p>Several elements are needed.</p>
<div class="section level4">
<h4 id="config-class">Config class<a class="anchor" aria-label="anchor" href="#config-class"></a>
</h4>
<p>The S4-class named Config is used to store information about the
tools. It contains the following external slots:</p>
<ul>
<li><p>fullname: the name of the workflow composed of the name of a
pipeline (prefix) and the name of the process (suffix),</p></li>
<li><p>mode: a character specifying if the class describes a process or
a pipeline,</p></li>
<li><p>steps: the list of steps names that composing the tool.
,</p></li>
<li><p>mandatory: a vector of the same length that steps and which
indicates whether each step is mandatory or not,</p></li>
</ul>
<p>These information (and the class) must be diffused via a function
which syntax is</p>
<p><em>fullname</em>_conf() where name_of_tool is the name of the tool.
This name must be the same as the value of the slot fullname.</p>
<pre><code><span><span class="fu">PipelineA_Process1_conf</span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>The source code</p>
</div>
</div>
<div class="section level3">
<h3 id="companion-package">Companion package<a class="anchor" aria-label="anchor" href="#companion-package"></a>
</h3>
<p>Nous décrivons ici quelques aspects fondamentaux des fonctions ui()
et server() pour les modules de traitement de données qui seront gérés
par MagellanNTK.</p>
<div class="section level4">
<h4 id="structure-of-a-magellan-compliant-module-process">Structure of a Magellan-compliant module process<a class="anchor" aria-label="anchor" href="#structure-of-a-magellan-compliant-module-process"></a>
</h4>
<p>As for any Shiny module, it must contain the two following functions:
ui() and server()</p>
<p>Ces fonctions doivent avoir des noms construits de la manière
suivante : 4 chaînes de caractères séparées par un ‘_’:</p>
<ul>
<li><p>xxx</p></li>
<li><p>xxxx</p></li>
<li><p>xxxx</p></li>
<li><p>xxxx</p></li>
</ul>
<p>Dans l’exemple ci-dessous, il s’agit d’un module nommé ‘Process1’ et
faisant partie d’un pipeline appelé ‘PipelineA’.</p>
<p>Si le module n’a pas de process parent, alors</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_process_PipelineA_Process1_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">mod_process_PipeA_Proc1_server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>,</span>
<span>    <span class="va">nav.mode</span> <span class="op">=</span> <span class="st">'process'</span>,</span>
<span>    <span class="va">dataIn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span><span class="cn">NULL</span><span class="op">}</span><span class="op">)</span>,</span>
<span>    <span class="va">steps.enabled</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span><span class="cn">NULL</span><span class="op">}</span><span class="op">)</span>,</span>
<span>    <span class="va">remoteReset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span><span class="cn">FALSE</span><span class="op">}</span><span class="op">)</span>,</span>
<span>    <span class="va">current.pos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="co"># This list contains the basic configuration of the process</span></span>
<span>    <span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        parent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        steps <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        mandatory <span class="op">=</span> <span class="cn">NULL</span></span>
<span>        <span class="op">)</span></span>
<span>  </span>
<span>    <span class="co"># Define default selected values for widgets</span></span>
<span>    <span class="co"># This is only for simple workflows</span></span>
<span>    <span class="va">widgets.default.values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Add your own code</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co">###-------------------------------------------------------------###</span></span>
<span>    <span class="co">###                                                             ###</span></span>
<span>    <span class="co">### ------------------- MODULE SERVER --------------------------###</span></span>
<span>    <span class="co">###                                                             ###</span></span>
<span>    <span class="co">###-------------------------------------------------------------###</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">ns</span> <span class="op">&lt;-</span> <span class="va">session</span><span class="op">$</span><span class="va">ns</span></span>
<span></span>
<span>        <span class="co"># Insert necessary code which is hosted by Magellan</span></span>
<span>        <span class="co"># DO NOT MODIFY THIS LINE</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">str2expression</a></span><span class="op">(</span></span>
<span>            <span class="fu">SimpleWorflowCoreCode</span><span class="op">(</span></span>
<span>            widgets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">widgets.default.values</span><span class="op">)</span>,</span>
<span>            steps <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">steps</span> <span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="co"># Add your UI stuff below</span></span>
<span></span>
<span>        <span class="co"># Insert necessary code which is hosted by Magellan</span></span>
<span>        <span class="co"># DO NOT MODIFY THIS LINE</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="../reference/insertCodeForExternalModules.html">Module_Return_Func</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="structure-of-a-magellan-compliant-module-pipeline">Structure of a Magellan-compliant module pipeline<a class="anchor" aria-label="anchor" href="#structure-of-a-magellan-compliant-module-pipeline"></a>
</h4>
</div>
<div class="section level4">
<h4 id="conventions-de-nommage">Conventions de nommage<a class="anchor" aria-label="anchor" href="#conventions-de-nommage"></a>
</h4>
<p>ceci est un poitn très important pour le bon fonctionnement des deux
packages. En effet, comme il a été précisé xxx, Magellan est un workflow
manager générique qui gère des modules dont on lui envoie la
configuration. Afin de respecter cette généricité, Magellan construit
dynamiquement un certain nombre de fonctions et de variables à partir de
la configuration des process et pipelines</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="type-of-objects">Type of objects<a class="anchor" aria-label="anchor" href="#type-of-objects"></a>
</h2>
<p>it is suitable for objects of type list for which the fundamental
requirments are:</p>
<ul>
<li><p>A list of items</p></li>
<li><p>Each item is named and can be accessed either by its name or
index</p></li>
<li><p>The exists an ‘append’ function and a ‘Remove’ function. The
first one adds an additional item at the end of the list (append
function). The last one can remove any of the item in the list (even
with a range) We hope that the source code of modules in
<code>Magellan</code> is sufficient to understand how it is structured.
We give here several additional tips for a better
understanding.</p></li>
</ul>
<p><code>Magellan</code> can handle different types (classes) of objects
but all based on the type <code>list</code>. To manipulate such objects,
it use most of the R functions like <code>[]</code>, <code>[[]]</code>,
etc… As it is generic, all types of objects used by the modules must
work with these basic functions.</p>
<p>However, two functions cannot be really generic: xxx and xxx(). They
are very simple (essentially they are wrappers for existing functions)
but necessary. These functions are defined as abstract in
<code>Magellan</code>. For the examples, <code>Magellan</code>
implements those functions for the simple class <code>list</code>. The
dev who want to write its own process module have to write the code of
these two functions for the class of its object.</p>
<div class="section level3">
<h3 id="the-instscripts-directory">The ‘inst/scripts’ directory<a class="anchor" aria-label="anchor" href="#the-instscripts-directory"></a>
</h3>
<p>The ‘R’ directory contains source code files. The files prefixed by
‘mod_’ contain a shiny module.</p>
<p>Among those files</p>
<p>The ‘inst/scripts’ directory contain the following files:</p>
<ul>
<li>min_simple_workflow_app_example.R: xxx</li>
<li>min_simple_workflow_app.R: xxx</li>
<li>test_data.R: xxx</li>
<li>test_mod_Test_Process1.R: xxx</li>
</ul>
<p>The directory ‘module_examples’ contain xxx</p>
</div>
</div>
<div class="section level2">
<h2 id="section"></h2>
<div class="section level3">
<h3 id="launch-a-workflow">Launch a workflow<a class="anchor" aria-label="anchor" href="#launch-a-workflow"></a>
</h3>
<p>As Magellan is a Shiny app, to launch the app, a few lines of code
are necessary. Here, are th minimum code to launch a worklfow called
Proc1 which belongs to a composed workflow called ‘PipeA’.</p>
<p>Here is explained a minimal shiny app (code in
‘/inst/scripts/min_simple_workflow_app_example.R’). Here are the
comments</p>
<p>Launch the packages</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r numberLines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">library</span>(MagellanNTK)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>f <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"module_examples"</span>, </span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="st">"example_module_PipelineA_Process1.R"</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="at">package=</span><span class="st">"Magellan"</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">source</span>(<span class="fu">file</span>(f), <span class="at">local=</span><span class="cn">TRUE</span>)<span class="sc">$</span>value</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="fu">mod_navigation_ui</span>(<span class="st">'PipelineA_Process1'</span>)</span>
<span id="cb4-10"><a href="#cb4-10"></a>)</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output){</span>
<span id="cb4-13"><a href="#cb4-13"></a>    <span class="fu">data</span>(feat1, <span class="at">package=</span><span class="st">'Magellan'</span>)</span>
<span id="cb4-14"><a href="#cb4-14"></a>    rv <span class="ot">&lt;-</span> <span class="fu">reactiveValues</span>(</span>
<span id="cb4-15"><a href="#cb4-15"></a>        <span class="at">dataIn =</span> feat1,</span>
<span id="cb4-16"><a href="#cb4-16"></a>        <span class="at">dataOut =</span> <span class="cn">NULL</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>        )</span>
<span id="cb4-18"><a href="#cb4-18"></a>  </span>
<span id="cb4-19"><a href="#cb4-19"></a>    <span class="fu">observe</span>({</span>
<span id="cb4-20"><a href="#cb4-20"></a>        rv<span class="sc">$</span>dataOut <span class="ot">&lt;-</span> <span class="fu">mod_navigation_server</span>(<span class="at">id =</span> <span class="st">'PipelineA_Process1'</span>,</span>
<span id="cb4-21"><a href="#cb4-21"></a>            <span class="at">nav.mode =</span> <span class="st">'process'</span>,</span>
<span id="cb4-22"><a href="#cb4-22"></a>            <span class="at">dataIn =</span> <span class="fu">reactive</span>({rv<span class="sc">$</span>dataIn})</span>
<span id="cb4-23"><a href="#cb4-23"></a>            )</span>
<span id="cb4-24"><a href="#cb4-24"></a>    }, <span class="at">priority=</span><span class="dv">1000</span>)</span>
<span id="cb4-25"><a href="#cb4-25"></a>}</span>
<span id="cb4-26"><a href="#cb4-26"></a></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="fu">shinyApp</span>(ui, server)</span></code></pre></div>
<p>As we can see, launching a shiny app which shows a process module
pass by <code>Magellan</code> which acts as a bridge package: the ui()
and server() functions of the app only call <code>Magellan</code>
functions.</p>
<p>There is here a first example of the imortance of names convention.
If we focus on the id of these functions, one can see that it is
composed of two concatenated strings : the name of the parent and the
name of the process. This id is splitted and xxxx. This string is
precisely the name of the procs module source code file in the external
package (but prefixed by ‘mod_’)</p>
<p>A generic script example is here:
‘/inst/scripts/min_simple_workflow_app.R’</p>
</div>
<div class="section level3">
<h3 id="naming-conventions-for-modules">Naming conventions for modules<a class="anchor" aria-label="anchor" href="#naming-conventions-for-modules"></a>
</h3>
<p>As <code>Magellan</code> heavily uses dynamically built function
names (to be generic), the naming of scripts and variables is
fundamental.</p>
<p>A module is well-defined by its <code>config</code> variable which
contains its name and the name of the parent workflow to which it
belongs to. In this document, ‘mod_name’ will refer to the name of the
module (i.e. Process1 as in example) and ‘parent_name’ to the name of
its parent (i.e. PipelineA as in example).</p>
<p>For more details on how to name files and variables in the process
modules, please read the manual ‘xxx’</p>
</div>
<div class="section level3">
<h3 id="requirments">Requirments<a class="anchor" aria-label="anchor" href="#requirments"></a>
</h3>
<p>This package must have xxx. Two other articles are available that
explain how to write a module for simple and composed workflows.</p>
</div>
<div class="section level3">
<h3 id="specific-functions-to-write">Specific functions to write<a class="anchor" aria-label="anchor" href="#specific-functions-to-write"></a>
</h3>
<p>Whether the class of the object, it may be necessary to write the
code for two functions that cannot be generic</p>
<ul>
<li>An append function named Add_Datasets_to_Object()</li>
<li>A remove function named Keep_Datasets_from_Object()</li>
</ul>
<p>Those functions must be part of the external package to avoid too
many dependancies for the package <code>Magellan</code>.</p>
<p>The developer of shiny modules that will use <code>Magellan</code>
can find in an exmaple of those functions that are implemented for the
type <code>list</code> and for examples purpose.</p>
</div>
</div>
<div class="section level2">
<h2 id="simple-workflow">Simple workflow<a class="anchor" aria-label="anchor" href="#simple-workflow"></a>
</h2>
<p>This vignette explains how to create a new process in the
<code>Magellan</code> framework. A process is a set of data processes
applied to a dataset (ie an object of class QFeatures).</p>
<p>We hope that the source code is well documented but we think it is a
good idea to start with this article. Normally, there is no need to go
deep in the source code to write your own process.</p>
<p>The code of a module for <code>Magellan</code> is structured so as to
have very few functions to write and develop your own module.</p>
<p>Examples of processes are in the inst/scripts directory. This
tutorial aims to explain step-by-step the construction of the
process</p>
<p>As a process in <code>Magellan</code> is a shiny module, it comes
with two functions ui() and server().</p>
<div class="section level3">
<h3 id="nomenclature-of-ui-and-server-functions">Nomenclature of ui and server functions<a class="anchor" aria-label="anchor" href="#nomenclature-of-ui-and-server-functions"></a>
</h3>
<p>The name of these functions is very important because Magellan call
those functions by building their name dynamically. C’est pour cela
qu’il est primordial de respecter la nomenclature.</p>
<p>Chacune des deux fonctions contient quatre mots-clés séparés par
‘_’:</p>
<ul>
<li>
<code>mod</code>:mot-clé fixe qui précise que la fonction est celle
d’un module,</li>
<li>
<code>pipeline_name</code>: le nom du pipeline auquel le process
appartient,</li>
<li>
<code>process_name</code>: le nom du process lui-même,</li>
<li>
<code>ui</code> ou <code>server</code> selon qu’il s’agit de la
fonction ui ou server.</li>
</ul>
<p>Par example, la fonction <code>mod_PipelineA_Process4_server()</code>
est le nom du serveur pour le process 4 du pipeline A.</p>
</div>
<div class="section level3">
<h3 id="timeline-styles">Timeline styles<a class="anchor" aria-label="anchor" href="#timeline-styles"></a>
</h3>
<p>The timelines are coded as modules. They are not exported as only
mod_navigation_server use them. However, it may be interesting to the
developer to know a little about them if he want to customize or develop
another timeline.</p>
<p>The look &amp; feel if managed by the ui() function while the logics
is managed by the module server() function. This server ensures that the
different states (enabled/disabled, color and style, display of the
cursor for the active step) of each item in the timeline works well</p>
<p>Despite that hose information are documented in the reference manual
of Magellan but it allows to better understand here how it works.</p>
<p>The server() function is based on the same fundamental code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_timeline_v_server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, </span>
<span>    <span class="va">config</span>, </span>
<span>    <span class="va">status</span>,</span>
<span>    <span class="va">position</span>,</span>
<span>    <span class="va">enabled</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">ns</span> <span class="op">&lt;-</span> <span class="va">session</span><span class="op">$</span><span class="va">ns</span></span>
<span>    </span>
<span>        <span class="va">UpdateTags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span><span class="va">...</span><span class="op">}</span><span class="op">)</span></span>
<span>        <span class="va">output</span><span class="op">$</span><span class="va">show_v_TL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span><span class="va">...</span><span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The parameters of the server are the same for both vertical and
horizontal timelines:</p>
<ul>
<li>id: the <code>id</code> of the server (same as the <code>id</code>
of the ui() function),</li>
<li>config: A <code>list</code> (not a <code>reactiveList</code>)
containing the same elements as the process module.</li>
<li>status: A <code>reactive vector</code> which contain the status
(validated, skipped or undone) of each step of the process module. Its
length is equal to the number of steps.</li>
<li>position: A <code>reactive integer</code> that reflects the position
of the current (active) step.</li>
<li>enabled: A <code>reactive vector</code> of length the number of
steps and which indicate if the step is enabled or disabled.</li>
</ul>
<p>The reactive function <code>UpdateTags()</code> updates a vector
containing the tags inserted in the css-style.</p>
</div>
</div>
<div class="section level2">
<h2 id="tools-for-developers">Tools for developers<a class="anchor" aria-label="anchor" href="#tools-for-developers"></a>
</h2>
<div class="section level3">
<h3 id="debug-module">Debug module<a class="anchor" aria-label="anchor" href="#debug-module"></a>
</h3>
<p>A shiny module called Debug_Infos is available to follow the
execution of a workflow and more precisely, the content of datasets.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R Under development (unstable) (2024-01-28 r85838 ucrt)</span></span>
<span><span class="co">## Platform: x86_64-w64-mingw32/x64</span></span>
<span><span class="co">## Running under: Windows 10 x64 (build 19045)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] LC_COLLATE=French_France.utf8  LC_CTYPE=French_France.utf8   </span></span>
<span><span class="co">## [3] LC_MONETARY=French_France.utf8 LC_NUMERIC=C                  </span></span>
<span><span class="co">## [5] LC_TIME=French_France.utf8    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Europe/Paris</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] BiocStyle_2.31.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] vctrs_0.6.5         cli_3.6.2           knitr_1.45         </span></span>
<span><span class="co">##  [4] rlang_1.1.3         xfun_0.43           highr_0.10         </span></span>
<span><span class="co">##  [7] purrr_1.0.2         textshaping_0.3.7   jsonlite_1.8.8     </span></span>
<span><span class="co">## [10] htmltools_0.5.8     ragg_1.3.0          sass_0.4.9         </span></span>
<span><span class="co">## [13] rmarkdown_2.26      evaluate_0.23       jquerylib_0.1.4    </span></span>
<span><span class="co">## [16] fastmap_1.1.1       yaml_2.3.8          lifecycle_1.0.4    </span></span>
<span><span class="co">## [19] memoise_2.0.1       bookdown_0.38       BiocManager_1.30.22</span></span>
<span><span class="co">## [22] compiler_4.4.0      fs_1.6.3            rstudioapi_0.16.0  </span></span>
<span><span class="co">## [25] systemfonts_1.0.6   digest_0.6.35       R6_2.5.1           </span></span>
<span><span class="co">## [28] magrittr_2.0.3      bslib_0.7.0         tools_4.4.0        </span></span>
<span><span class="co">## [31] pkgdown_2.0.7       cachem_1.0.8        desc_1.4.3</span></span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Samuel Wieczorek, Thomas Burger.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
